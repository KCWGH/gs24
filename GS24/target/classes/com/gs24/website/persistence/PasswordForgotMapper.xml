<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.PasswordForgotMapper">

	<!-- 이메일이 MEMBER 테이블에 있는지 확인 -->
	<select id="checkEmailExists" resultType="int">
		SELECT COUNT(*)
		FROM
		MEMBER
		WHERE EMAIL = #{email}
	</select>

	<!-- 인증번호를 PASSWORD_RESET 테이블에 저장 -->
	<insert id="insertResetCode">
		INSERT INTO PASSWORD_RESET (EMAIL, RESET_CODE,
		TIMESTAMP)
		VALUES (#{email}, #{resetCode}, SYSDATE)
	</insert>

	<!-- PASSWORD_RESET 테이블에서 최신 인증번호 가져오기 -->
	<select id="getLatestResetCode" resultType="String">
		SELECT RESET_CODE
		FROM PASSWORD_RESET
		WHERE EMAIL = #{email}
		ORDER BY TIMESTAMP DESC
		FETCH
		FIRST 1 ROWS ONLY
	</select>

	<!-- 이메일로 비밀번호 조회 -->
	<select id="getPasswordByEmail" resultType="String">
		SELECT PASSWORD
		FROM
		MEMBER
		WHERE EMAIL = #{email}
	</select>

</mapper>
